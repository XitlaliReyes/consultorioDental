<div class="dashboard-container">
  <aside class="sidebar">
    <div class="sidebar-header">
        <h2> Panel M√©dico</h2>
    </div>
    <nav class="sidebar-nav">
        <div class="menu-label"></div> 
        
        <a (click)="navegarA('dashboard')" 
           [class.active]="vistaActual === 'dashboard'" 
           class="nav-item">
            <span class="icon fa-solid fa-gauge"></span> Dashboard 
        </a>
        
        <a (click)="navegarA('pacientes')" 
           [class.active]="vistaActual === 'pacientes' || vistaActual === 'paciente-detalle'" 
           class="nav-item">
            <span class="icon fa-solid fa-users"></span> Pacientes
        </a>
        <a href="#" class="nav-item">
            <span class="icon fa-regular fa-clipboard-list"></span> Historiales
        </a>

        
        <a class="nav-item logout" (click)="logout()">
            <span class="icon fa-solid fa-right-from-bracket"></span> Cerrar Sesi√≥n
        </a>
    </nav>
</aside>

  <main class="main-content">
    <div *ngIf="vistaActual === 'dashboard'">
      <header class="dashboard-header">
        <div>
          <h1>Bienvenido, Dr. {{ medicoNombre }} {{ medicoApellidos }}</h1>
          <span class="user-email">{{ medicoCorreo }}</span>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-info">
            <h3>Citas Asignadas</h3>
            <p class="stat-number">{{ misCitas.length }}</p>
          </div>
        </div>
      
        <div class="stat-card">
          <div class="stat-icon">‚è∞</div>
          <div class="stat-info">
            <h3>Citas Hoy</h3>
            <p class="stat-number">{{ citasHoy }}</p>
          </div>
        </div>
      
        <div class="stat-card">
          <div class="stat-icon">üîî</div>
          <div class="stat-info">
            <h3>Pendientes</h3>
            <p class="stat-number">{{ totalCitasPendientes }}</p>
          </div>
        </div>
      
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-info">
            <h3>Esta Semana</h3>
            <p class="stat-number">{{ citasEstaSemana }}</p>
          </div>
        </div>
      </div>

      <div class="content-grid">
        <section class="card">
            <div class="card-header">
                <h2 class="card-title">Pr√≥ximas Citas</h2>
                <button class="btn-refresh" (click)="cargarMisCitas()">üîÑ</button>
            </div>
            
            <div *ngIf="isLoadingCitas" class="loading-state">
                <p>Cargando citas...</p>
            </div>
    
            <div *ngIf="!isLoadingCitas && misCitas.length === 0" class="empty-state">
                <p> No tienes citas asignadas</p>
            </div>
    
            <div *ngIf="!isLoadingCitas && misCitas.length > 0" class="citas-container">
              <div *ngFor="let cita of misCitas" class="cita-card">
                  <div class="cita-header">
                      <span class="fecha">{{ formatearFecha(cita.Fecha) }}</span>
                      <span class="hora">{{ formatearHora(cita.Hora) }}</span>
                      
                     
                  </div>
                  
                  <div class="cita-body">
                      <p class="paciente-nombre">{{ cita.Paciente_Nombre }}</p>
                      
                      <p class="servicio">Servicio: {{ cita.Servicio }}</p>
                      <p class="contacto">Tel√©fono: {{ cita.Paciente_Telefono }}</p>
                  </div>
                  
                  <div *ngIf="cita.Notas" class="cita-notas">
                      üìù Notas: {{ cita.Notas }}
                  </div>
          
                  <div class="cita-acciones">
                      <button
                          *ngIf="cita.Estado === 'Agendada' || cita.Estado === 'Confirmada'"
                          class="btn-accion btn-cancelar" 
                          (click)="cancelarCita(cita.ID_Cita)"
                          [disabled]="procesandoCita === cita.ID_Cita"
                      >
                          {{ procesandoCita === cita.ID_Cita ? 'Cancelando...' : 'Cancelar Cita' }}
                      </button>
                  </div>
                  </div>
          </div>
        </section>
    </div>
    </div>

    <div *ngIf="vistaActual === 'citas'">
      <app-citas-medico></app-citas-medico>
    </div>

    <div *ngIf="vistaActual === 'pacientes'">
        <header class="dashboard-header">
            <h1>Mis Pacientes Asignados</h1>
        </header>

        <section class="card">
            <div class="card-header">
                <h2 class="card-title">Pacientes √önicos</h2>
                <button class="btn-refresh" (click)="cargarMisPacientes()">üîÑ</button>
            </div>

            <div *ngIf="isLoadingPacientes" class="loading-state">
                <p>Cargando lista de pacientes...</p>
            </div>

            <div *ngIf="!isLoadingPacientes && misPacientes.length === 0" class="empty-state">
                <p>A√∫n no tienes pacientes asignados de citas no canceladas.</p>
            </div>

            <div *ngIf="!isLoadingPacientes && misPacientes.length > 0" class="list-container">
                <div *ngFor="let paciente of misPacientes" class="list-item paciente-item">
                    <div class="item-info">
                        <strong>{{ paciente.Nombre }}</strong>
                    </div>
                    <button class="btn btn-primary" (click)="verDetallePaciente(paciente.ID_Paciente)">
                        <span class="icon fa-solid fa-eye"></span> Ver Paciente
                    </button>
                </div>
            </div>
        </section>
    </div>

    <div *ngIf="vistaActual === 'paciente-detalle'">
        <header class="dashboard-header">
            <h1>Detalle del Paciente</h1>
            <button class="btn-back" (click)="navegarA('pacientes')">
                ‚Üê Volver a la Lista
            </button>
        </header>

        <div *ngIf="isLoadingDetalle" class="loading-state">
            <p>Cargando informaci√≥n del paciente...</p>
        </div>

        <section *ngIf="!isLoadingDetalle && pacienteSeleccionado" class="card paciente-detalle-card">
          <h2 class="card-title">{{ pacienteSeleccionado.Nombre }}</h2>
          
          <div class="detalle-grid">
              <div>
                  <strong>Contacto</strong>
                  <p>Correo<span class="detalle-valor">{{ pacienteSeleccionado.Correo }}</span></p>
                  <p>Tel√©fono<span class="detalle-valor">{{ pacienteSeleccionado.Telefono }}</span></p>
              </div>
              <div>
                  <strong>Datos Personales</strong>
                  <p>Nacimiento<span class="detalle-valor">{{ formatearFecha(pacienteSeleccionado.FechaNacimiento) }}</span></p>
                  <p>Sexo<span class="detalle-valor">{{ pacienteSeleccionado.Sexo === 'M' ? 'Masculino' : 'Femenino' }}</span></p>
                  <p>Ocupaci√≥n<span class="detalle-valor">{{ pacienteSeleccionado.Ocupacion }}</span></p>
              </div>
              <div>
                  <strong>Ubicaci√≥n</strong>
                  <p>Direcci√≥n<span class="detalle-valor">{{ pacienteSeleccionado.Direccion }}</span></p>
                  <p>Ciudad<span class="detalle-valor">{{ pacienteSeleccionado.Ciudad }}</span></p>
                  <p>C.P.<span class="detalle-valor">{{ pacienteSeleccionado.Codigo_Postal }}</span></p>
              </div>
          </div>
          
          <div class="paciente-acciones">
              <button class="btn btn-secondary">Ver Historial Cl√≠nico</button>
          </div>
      </section>

        <div *ngIf="!isLoadingDetalle && !pacienteSeleccionado" class="error-state">
            <p>No se pudo cargar la informaci√≥n del paciente. Intente de nuevo.</p>
        </div>
    </div>
  </main>
</div>